build:
  gpu: true
  cuda: "12.1"
  python_version: "3.10"
  python_requirements: "requirements.txt"

  system_packages:
    - libgl1-mesa-glx
    - libglib2.0-0
    - libgomp1
    - wget

  run:
    - curl -o /usr/local/bin/pget -L "https://github.com/replicate/pget/releases/latest/download/pget_$(uname -s)_$(uname -m)" && chmod +x /usr/local/bin/pget
    - echo "Building custom rasterizer..." && (cd hy3dpaint/custom_rasterizer && export TORCH_CUDA_ARCH_LIST="7.5;8.0;8.6;8.9;9.0;9.0+PTX" && python setup.py install)
    - echo "Building differentiable renderer..." && (cd hy3dpaint/DifferentiableRenderer && export TORCH_CUDA_ARCH_LIST="7.5;8.0;8.6;8.9;9.0;9.0+PTX" && bash compile_mesh_painter.sh)

predict: "predict.py:Predictor" 